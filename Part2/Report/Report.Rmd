---
title: 'DATS6101 Project 2: Exploring Hotel Booking Cancellations'
author: "Group 6 : Jasreen Kaur Mehta, Pranav Dhawan, Tycho Gormley"
date: '`r Sys.Date()`'
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r init, include=FALSE}
#Import required libraries
library(ezids)
library(ggplot2)
library(dplyr)
library(caret)
library(tidyverse)
library(pROC)
library(corrplot)
library(randomForest)
library(rpart)
library(rpart.plot)
library(glmnet)
library(car)
library(doParallel)

#Setup knitter options
knitr::opts_chunk$set(warning = F, message = F)
options(scientific=T, digits = 3)
```

# **Part 1 Recap**

## **Introduction**
In our Part 1, we analyzed a hotel booking dataset from the INN Hotels Group to understand the factors influencing booking cancellations.\

```{r import_dataset}
hotel_data <- read.csv("../../Dataset/INNHotelsGroup_min.csv")
hotel_datay <- read.csv("../../Dataset/INNHotelsGroup.csv")
``` 

```{r data_structure}
str(hotel_datay)
```
The dataset contains hotel bookings collected from 2017-2018 and is characterized by a total of 19 columns, comprising 5 categorical and 14 numerical variables.\

## **Exploratory Data Analysis (EDA)**

### **1. Summary Statistics **\
```{r summary}
summary(hotel_data)
```

**Summary:**\
The average price per room in the dataset is 103 euros, with a median of 99 euros, but prices can reach up to 540 euros, indicating high-priced outliers. Some entries even show an average price of zero, possibly reflecting promotional deals. Guests typically stay for two weekday nights and one weekend night, with the average number of weekday nights being 2.2 and weekend nights 0.81. Stays can extend to as many as 17 weekday nights. Most bookings involve two adults, and many guests do not bring children. Lead times vary significantly, with an average of 85 days, a median of 57, and some bookings made up to 443 days in advance, suggesting a right-skewed distribution. The data also shows sparse previous cancellations, with an average of just 0.02, and a maximum of 58. Bookings are spread over 2017 and 2018, peaking in August. Additionally, most guests do not make special requests, as the median is zero, although some make up to five requests per booking.\

### **2. Distribution of Booking Status**\
```{r plot1}
print(ggplot(hotel_data, aes(x = booking_status)) +
  geom_bar(fill = "lightblue") +
  labs(title = "Booking Status Distribution", x = "Booking Status", y = "Count"))
```

**Summary** \
The dataset contains 36,275 bookings. Of the total bookings, 24,390 bookings were not canceled (67.2%), while 11,885 bookings were canceled (32.8%), reflecting a significant cancellation rate that offers rich insights into factors influencing booking decisions.\

### **3. Barplot: Number of Special Requests** \
```{r plot2}
print(ggplot(hotel_data, aes(x = factor(no_of_special_requests))) +
  geom_bar(fill = "lightblue") +
  labs(title = "Number of Special Requests", x = "Number of Special Requests", y = "Count") +
  theme_minimal())
```

**Summary** \
Most guests make no special requests, with a sharp decline as the number increases. A significant portion makes one request, while two or more requests are increasingly rare.

### **4. Plot: Market Segment vs Booking Status** \
```{r plot3}
contingency_table <- table(hotel_data$market_segment_type, hotel_data$booking_status)

plot_data <- as.data.frame(contingency_table)
colnames(plot_data) <- c("Market_Segment", "Booking_Status", "Count")

print(ggplot(plot_data, aes(x = Market_Segment, y = Count, fill = Booking_Status)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Booking Status by Market Segment",
       x = "Market Segment",
       y = "Count",
       fill = "Booking Status") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)))
```

**Summary** \
Online market segment have the highest cancellation count, with a large proportion of canceled bookings of 8475.
Offline segment has a cancellation count of 3253
For other market segment, the cancellation rates are too less.

### **5. Histogram: Lead_time** \
```{r plot4}
ggplot(hotel_data, aes(x = lead_time, fill = booking_status)) +
  geom_histogram(binwidth = 10, position = "dodge") +
  labs(
    title = "Lead Time vs Booking Status",
    x = "Lead Time (Days)",
    y = "Number of Bookings",
    fill = "Booking Status"
  ) +
  theme_minimal()
```

**Summary** \
Here we can see that the booking with short lead times are less cancelled and as the lead time increases there are more booking cancellations. Also, we can see more cancellation happening between lead time form 100-200.

### **6. Boxplot: avg_price_per_room** \
```{r plot5}
ggplot(hotel_data, aes(x = booking_status, y = avg_price_per_room, fill = booking_status)) +
  geom_boxplot() +
  labs(
    title = "Average Room Price vs Booking Status",
    x = "Booking Status",
    y = "Average Room Price"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

**Summary** \
The booking with cancelled status has higher median average room price value compared to non-cancelled booking status.This might mean that the booking with her average room price have more chances to get cancelled.

## **Key Statistical Findings**

**1. Special Requests and Cancellations:** \
Bookings with special requests had a significantly lower cancellation rate (20.2%) compared to those without (43.2%).\ 
Chi-square test revealed a statistically significant association between special requests and booking status.\

**2. Previous Cancellation History:**\
Surprisingly, guests with previous cancellations had a much lower current cancellation rate (4.73%) compared to those without (33.03%).\
This suggests that past cancellation history might not be a straightforward predictor of future booking behavior.\

**3. Factors Influencing Cancellations:**\
**3.1 Lead Time:**\

1. Average lead time for canceled bookings: 139.2 days\
2. Average lead time for non-canceled bookings: 58.9 days\
3. Longer lead times strongly correlated with higher cancellation probability.\

**3.2 Room Price:**\

1. Canceled bookings had a higher average room price.\
2. Price difference: Approximately 10.7 units higher for canceled bookings.\

**4. Seasonal Variations:**\
The correlation between factors and cancellations varied across seasons:\

**4.1 Fall:**\
Strongest lead time correlation (0.54).\

**4.2 Summer:**\
Special requests most negatively correlated with cancellations (-0.30).\

**4.3 Spring:** \
Unique pattern with special requests having a strong negative correlation (-0.36).\

**4.4 Winter:** \
Slightly different dynamics with weaker correlations.\

```{r correlation, fig.width=15, fig.height=10}
hotel_data$booking_status_binary <- ifelse(hotel_data$booking_status == "Canceled", 1, 0)

remove_zero_variance <- function(df) {
  df[, sapply(df, function(col) sd(col, na.rm = TRUE) != 0)]
}

data_filtered <- remove_zero_variance(select_if(hotel_data, is.numeric))

cor_data <- cor(data_filtered, use = "complete.obs")

corrplot(cor_data, method = "color", addCoef.col = "black", 
         title = "Correlation Matrix Recap", number.cex = 1, 
         tl.cex = 0.8, mar = c(1, 1, 2, 1))
```

Lead time strongly predicts cancellations, with longer lead times increasing likelihood (0.44). More special requests (-0.25) and repeated guest status (-0.11) reduce cancellations, reflecting customer commitment and loyalty. Price per room has a weak positive correlation (0.14) with cancellations. Factors like travel party size and stay length show minimal impact on cancellation likelihood.\

## **Preliminary Conclusions:**\

**1.** Lead time emerged as the most critical factor in predicting booking cancellations.\
**2.** Special requests significantly reduce the likelihood of cancellations.\
**3.** Booking behavior varies considerably across different seasons.\
**4.** Higher-priced rooms show a slight tendency towards more cancellations.\

# **SMART Questions:** \

## **1. Can we predict the likelihood of booking cancellation based on the lead time?**\

```{r}
set.seed(123)
train_index <- createDataPartition(hotel_data$booking_status_binary, p = 0.7, list = FALSE)
train_data <- hotel_data[train_index, ]
test_data <- hotel_data[-train_index, ]
```

```{r}
logistic_model <- glm(
  booking_status_binary ~ lead_time,
  data = train_data, 
  family = binomial()
)

summary(logistic_model)
```

```{r}
test_predictions <- predict(logistic_model, newdata = test_data, type = "response")
predicted_classes <- ifelse(test_predictions > 0.5, 1, 0)
```

```{r}
confusion_matrix <- table(Actual = test_data$booking_status_binary, 
                          Predicted = predicted_classes)
print("Confusion Matrix:")
print(confusion_matrix)
```

```{r}
accuracy <- sum(diag(confusion_matrix)) / sum(confusion_matrix)
precision <- confusion_matrix[2,2] / sum(confusion_matrix[,2])
recall <- confusion_matrix[2,2] / sum(confusion_matrix[2,])
f1_score <- 2 * (precision * recall) / (precision + recall)

cat("\nModel Performance Metrics:\n")
cat("Accuracy:", round(accuracy, 4), "\n")
cat("Precision:", round(precision, 4), "\n")
cat("Recall:", round(recall, 4), "\n")
cat("F1 Score:", round(f1_score, 4), "\n")
```

**1. Accuracy:** 0.754, meaning the model correctly classifies 75.4% of the bookings.\
**2. Precision:** 0.723, indicating that 72.3% of the predictions of canceled bookings are correct.\
**3. Recall:** 0.415, meaning the model correctly identifies 41.5% of the actual canceled bookings.\
**4. F1-Score:** 0.527, which is the harmonic mean of precision and recall, providing a balanced evaluation of the model's performance.\

```{r}
roc_curve <- roc(test_data$booking_status_binary, test_predictions)
plot(roc_curve, main = "ROC Curve for Booking Cancellation Prediction")
```

The plot indicates that as the specificity (the ability to correctly identify non-canceled bookings) increases, the sensitivity (the ability to correctly identify canceled bookings) also increases. This suggests that the model has good discriminative power in predicting booking cancellations.\

```{r}
auc_value <- auc(roc_curve)
cat("Area Under the ROC Curve (AUC):", round(auc_value, 4), "\n")
```

Area Under the ROC Curve (AUC): 0.75, suggesting the model has good discriminative power in predicting booking cancellations.\

```{r}
hotel_data$booking_status_binary <- as.numeric(as.character(hotel_data$booking_status_binary))

ggplot(hotel_data, aes(x = lead_time, y = booking_status_binary)) +
  geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE) +
  labs(
    title = "Probability of Booking Cancellation vs Lead Time",
    x = "Lead Time (Days)",
    y = "Probability of Cancellation"
  ) +
  theme_minimal()
```

The graph shows the relationship between the lead time (in days) and the probability of booking cancellation. As the lead time increases, the probability of booking cancellation rises in a non-linear fashion, with the curve becoming more steep at higher lead times.\

## **2. Can we predict high-demand periods?**
 
```{r}
prepare_booking_data <- function(hotel_data) {
  booking_data <- hotel_data %>%
    mutate(
      high_demand = as.factor(ifelse(
        avg_price_per_room > quantile(avg_price_per_room, 0.75), 
        1, 0
      )),
      booking_month = as.factor(arrival_month),
      is_weekend = no_of_weekend_nights > 0,
      total_nights = no_of_weekend_nights + no_of_week_nights,
      is_repeated_guest = repeated_guest > 0
    )
  
  return(booking_data)
}
prepared_data <- prepare_booking_data(hotel_data)
```

```{r}
set.seed(123)
train_index <- createDataPartition(prepared_data$high_demand, p = 0.7, list = FALSE)
train_data <- prepared_data[train_index, ]
test_data <- prepared_data[-train_index, ]
```

```{r}
# Random Forest Model
rf_model <- randomForest(
  high_demand ~ lead_time + 
                total_nights + 
                booking_month + 
                market_segment_type + 
                is_repeated_guest,
  data = train_data,
  ntree = 500,
  importance = TRUE
)

evaluate_model <- function(actual, predicted, model_name) {
  conf_matrix <- confusionMatrix(as.factor(predicted), as.factor(actual))
  
  results <- data.frame(
    Model = model_name,
    Accuracy = conf_matrix$overall['Accuracy'],
    Precision = conf_matrix$byClass['Precision'],
    Recall = conf_matrix$byClass['Recall'],
    F1 = conf_matrix$byClass['F1']
  )
  
  return(results)
}

rf_pred <- predict(rf_model, newdata = test_data, type = "prob")[,2]
rf_class <- ifelse(rf_pred > 0.5, 1, 0)
```

```{r}
rf_results <- evaluate_model(test_data$high_demand, rf_class, "Random Forest")
print(rf_results)
```

```{r}
rf_importance <- data.frame(
  Feature = rownames(importance(rf_model)),
  Importance = importance(rf_model)[,1]
) %>% arrange(desc(Importance))
print(head(rf_importance, 10))
```

```{r}
ggplot(head(rf_importance, 10), aes(x = reorder(Feature, Importance), y = Importance)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(
    title = "Top 10 Features Predicting High-Demand Periods",
    x = "Features",
    y = "Importance"
  ) +
  theme_minimal()
```

```{r}
predict_high_demand_periods <- function(model, test_data) {
  pred_probs <- predict(model, newdata = test_data, type = "prob")[,2]
  high_demand_periods <- test_data[pred_probs > 0.7, ]
  
  print("High-Demand Periods Prediction:")
  print(paste("Total High-Demand Periods:", sum(pred_probs > 0.7)))
  print("Sample of High-Demand Periods:")
  print(head(high_demand_periods))
  
  return(high_demand_periods)
}

high_demand_periods <- predict_high_demand_periods(rf_model, test_data)
```

## **3. What is the relationship between room price and the likelihood of a booking being canceled or not?**

```{r}
# Fit a logistic regression model
lrmodel1 <- glm(booking_status_binary ~ avg_price_per_room, data = hotel_data, family = binomial)

summary(lrmodel1)
```

```{r}
hotel_data$predicted_prob <- predict(lrmodel1, type = "response")

hotel_data$predicted_class <- ifelse(hotel_data$predicted_prob > 0.5, 1, 0)

# Model evaluation
conf_matrix <- table(hotel_data$booking_status_binary, hotel_data$predicted_class)
accuracy <- sum(diag(conf_matrix)) / sum(conf_matrix)
print(paste("Accuracy:", round(accuracy, 2)))
```

```{r}
roc_curve <- roc(hotel_data$booking_status_binary, hotel_data$predicted_prob)
plot(roc_curve)
```

```{r}
auc_value <- auc(roc_curve)
print(paste("AUC:", round(auc_value, 2)))
```

```{r}
# Scatter plot to examine the relationship between price and cancellation
plot(hotel_data$avg_price_per_room, hotel_data$booking_status_binary, 
     main = "Scatter plot of Avg Price per Room vs Booking Status", 
     xlab = "Average Price per Room", ylab = "Booking Status")
```

```{r}
# Boxplot for average price per room vs booking cancellation status
boxplot(avg_price_per_room ~ booking_status_binary, data = hotel_data, 
        main = "Boxplot of Avg Price per Room vs Booking Status", 
        xlab = "Booking Status", ylab = "Average Price per Room")
```

## **4. How do seasonal trends impact cancellation rates and booking patterns?**\

### **Define seasons based on arrival month:**
```{r}
hotel_data$season <- case_when(
  hotel_data$arrival_month %in% c(3, 4, 5) ~ "Spring",
  hotel_data$arrival_month %in% c(6, 7, 8) ~ "Summer",
  hotel_data$arrival_month %in% c(9, 10, 11) ~ "Fall",
  hotel_data$arrival_month %in% c(12, 1, 2) ~ "Winter",
  TRUE ~ "Unknown"
)
```

### **Creating subsets for each season:**
```{r subset_creation}
# Create subsets for each season
spring_data <- subset(hotel_data, season == "Spring")
summer_data <- subset(hotel_data, season == "Summer")
fall_data <- subset(hotel_data, season == "Fall")
winter_data <- subset(hotel_data, season == "Winter")
```

### **Remove columns with zero variance:**
```{r remove_column}
# Function to remove columns with zero variance
remove_zero_variance <- function(df) {
  df[, sapply(df, function(col) sd(col, na.rm = TRUE) != 0)]
}

# Remove zero variance columns for each season
spring_data_filtered <- remove_zero_variance(select_if(spring_data, is.numeric))
summer_data_filtered <- remove_zero_variance(select_if(summer_data, is.numeric))
fall_data_filtered <- remove_zero_variance(select_if(fall_data, is.numeric))
winter_data_filtered <- remove_zero_variance(select_if(winter_data, is.numeric))
```

### **Calculate correlation matrices:**
```{r seasonal_correlation, fig.width=15, fig.height=10}
# Calculate and visualize correlation for Spring
cor_spring <- cor(spring_data_filtered, use = "complete.obs")
corrplot(cor_spring, method = "color", addCoef.col = "black", 
         title = "Correlation Matrix for Spring", number.cex = 1, 
         tl.cex = 0.8, mar = c(1, 1, 2, 1))

# Calculate and visualize correlation for Summer
cor_summer <- cor(summer_data_filtered, use = "complete.obs")
corrplot(cor_summer, method = "color", addCoef.col = "black", 
         title = "Correlation Matrix for Summer", number.cex = 1, 
         tl.cex = 0.8, mar = c(1, 1, 2, 1))

# Calculate and visualize correlation for Fall
cor_fall <- cor(fall_data_filtered, use = "complete.obs")
corrplot(cor_fall, method = "color", addCoef.col = "black", 
         title = "Correlation Matrix for Fall", number.cex = 1, 
         tl.cex = 0.8, mar = c(1, 1, 2, 1))

# Calculate and visualize correlation for Winter
cor_winter <- cor(winter_data_filtered, use = "complete.obs")
corrplot(cor_winter, method = "color", addCoef.col = "black", 
         title = "Correlation Matrix for Winter", number.cex = 1, 
         tl.cex = 0.8, mar = c(1, 1, 2, 1))
```

### Logistic Regression: Impact of Seasonality on Booking Status

```{r}
### Logistic Regression: Impact of Seasonality on Booking Status
# Fit logistic regression model
logit_model <- glm(booking_status_binary ~ season, family = binomial, data = hotel_data)

# Summarize the logistic regression model
summary(logit_model)

# Calculate odds ratios for the season coefficients
odds_ratios <- exp(coef(logit_model))
print(odds_ratios)

# Predict probabilities using the logistic regression model
hotel_data$predicted_probs <- predict(logit_model, type = "response")

# Classify predictions using a 0.5 cutoff
hotel_data$predicted_class <- ifelse(hotel_data$predicted_probs >= 0.5, 1, 0)

# Confusion matrix
confusion_matrix <- table(Predicted = hotel_data$predicted_class, Actual = hotel_data$booking_status_binary)
print(confusion_matrix)

# Calculate accuracy
accuracy <- sum(diag(confusion_matrix)) / sum(confusion_matrix)
cat("Accuracy:", accuracy, "\n")
```

```{r}
# Fit a decision tree with adjusted parameters
tree_model <- rpart(
  booking_status_binary ~ season + lead_time + no_of_special_requests,
  data = hotel_data,
  method = "class",
  control = rpart.control(cp = 0.001, minsplit = 10, maxdepth = 5)  # Lower cp and minsplit to allow more splits
)

# Plot the updated decision tree
rpart.plot(tree_model, type = 3, extra = 102, fallen.leaves = TRUE, 
           main = "Decision Tree: Seasonal Trends and Cancellations")
```

## **5. What key factors most strongly influence booking cancellations?**\

```{r}
hotel_data$type_of_meal_plan <- as.factor(hotel_data$type_of_meal_plan)
hotel_data$room_type_reserved <- as.factor(hotel_data$room_type_reserved)
hotel_data$market_segment_type <- as.factor(hotel_data$market_segment_type)
hotel_data$arrival_month <- as.factor(hotel_data$arrival_month)
```

```{r}
rf_model1 <-randomForest(booking_status_binary ~ no_of_adults + no_of_children + no_of_weekend_nights + 
                          no_of_week_nights + type_of_meal_plan + required_car_parking_space + 
                          room_type_reserved + lead_time + arrival_year + arrival_month + 
                          market_segment_type + repeated_guest + 
                          no_of_previous_cancellations + avg_price_per_room + no_of_special_requests,
                        data = hotel_data, importance = TRUE, ntree = 100)

feature_importance <- importance(rf_model1)

importance_df <- data.frame(Feature = rownames(feature_importance), Importance = feature_importance[,1])

importance_df <- importance_df[order(-importance_df$Importance),]
importance_df
```

```{r}
ggplot(importance_df, aes(x = reorder(Feature, Importance), y = Importance)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() +  # Flip the axes to make it easier to read
  labs(title = "Feature Importance from Random Forest Model",
       x = "Feature", y = "Importance") +
  theme_minimal()
```

```{r}

# Converting booking status to numeric
hotel_data$booking_status_binary <- as.numeric(hotel_data$booking_status_binary)
hotel_data$market_segment_type_num <- as.numeric(hotel_data$market_segment_type)
hotel_data$arrival_month_num <- as.numeric(hotel_data$arrival_month)

corr_data <- hotel_data[, c("booking_status_binary", "lead_time", "no_of_special_requests", 
                            "avg_price_per_room", "market_segment_type_num", "no_of_week_nights", 
                            "no_of_weekend_nights", "arrival_month_num")]

#correlation matrix
cor_matrix <- cor(corr_data)

print(cor_matrix)

# Plotting the correlation matrix using corrplot
corrplot(cor_matrix, method = "circle", type = "lower", tl.col = "black", tl.srt = 45)

```

## **Building booking cancellation predictive model using the key factors**

### **Checking for multicollinearity**
```{r}

# Assuming you've already fitted the logistic regression model
lm_model1 <- lm(booking_status_binary ~ lead_time + no_of_special_requests + avg_price_per_room + 
                 market_segment_type + no_of_week_nights + no_of_weekend_nights + arrival_month,
                 data = hotel_data)
#summary(lm_model1)

gvif_values <- vif(lm_model1)

print(gvif_values)

```

### **Building model using Random Forest**
```{r}

hotel_data$booking_status_binary <- as.factor(hotel_data$booking_status_binary)

# Fit Random Forest model for classification (binary target)
rf_model2 <- randomForest(booking_status_binary ~ lead_time + no_of_special_requests + avg_price_per_room + 
                          market_segment_type + no_of_week_nights + no_of_weekend_nights + arrival_month, 
                          data = hotel_data, ntree = 100)

# Print the model summary to ensure it's treated as classification
print(rf_model2)
```

```{r}
pred_class_rf <- predict(rf_model2, newdata = hotel_data)

# Confusion Matrix (Make sure both predicted and actual values have the same levels)
conf_matrix_rf <- confusionMatrix(pred_class_rf, hotel_data$booking_status_binary)
conf_matrix_rf
# Print confusion matrix and the calculated metrics

conf_matrix_df <- as.data.frame(as.table(conf_matrix_rf))
conf_matrix_df
colnames(conf_matrix_df) <- c("Actual", "Predicted", "Freq")  # Rename columns for clarity

# Plot confusion matrix as heatmap using ggplot2
ggplot(conf_matrix_df, aes(x = Predicted, y = Actual, fill = Freq)) +
  geom_tile() +
  geom_text(aes(label = Freq), color = "black", size = 6) +
  scale_fill_gradient(low = "white", high = "blue") +
  labs(x = "Predicted", y = "Actual", title = "Confusion Matrix Heatmap") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Extracting Precision, Recall, and Accuracy from the confusion matrix
precision <- conf_matrix_rf$byClass['Pos Pred Value']
recall <- conf_matrix_rf$byClass['Sensitivity']
accuracy <- conf_matrix_rf$overall['Accuracy']

cat("Precision:", round(precision, 4), "\n")
cat("Recall:", round(recall, 4), "\n")
cat("Accuracy:", round(accuracy, 4), "\n")
```

```{r}
# Predict class probabilities for the binary outcome (probabilities for each class, we need the second column for class 1)
pred_probs_rf <- predict(rf_model2, newdata = hotel_data, type = "prob")[, 2]

# Calculate ROC-AUC for Random Forest (use the second column for class 1 probabilities)
roc_curve_rf <- roc(hotel_data$booking_status_binary, pred_probs_rf)

# Plot the ROC curve
plot(roc_curve_rf, main = "ROC Curve for Random Forest Model")

# Print AUC value
auc_value_rf <- auc(roc_curve_rf)
cat("AUC:", round(auc_value_rf, 4), "\n")
```

### **Validating the model by cross-validation with Random Forest using 5-fold cross-validation**
```{r}

# Set up parallel processing (use all but 1 core)
cl <- makeCluster(detectCores() - 1)
registerDoParallel(cl)

# Reduce number of trees for faster cross-validation
ntree_val <- 50

# Perform cross-validation with Random Forest using 5-fold cross-validation
cv_model <- train(booking_status_binary ~ lead_time + no_of_special_requests + avg_price_per_room + 
                  market_segment_type + no_of_week_nights + no_of_weekend_nights + arrival_month, 
                  data = hotel_data,
                  method = "rf",
                  trControl = trainControl(method = "cv", number = 5),  # 5-fold cross-validation
                  tuneGrid = data.frame(mtry = 3),  # You can adjust mtry for tuning
                  ntree = ntree_val)  # Set ntree to a smaller value for faster computation

# Print the results of cross-validation
print(cv_model)

# Stop the parallel cluster
stopCluster(cl)

```

# **References**
1. Antonio, N., de Almeida, A., & Nunes, L. (2017). Predicting hotel bookings cancellation with a machine learning          classification model. In 2017 IEEE International Conference on Data Mining Workshops (ICDMW) (pp. 1100–1107). IEEE. https://ieeexplore.ieee.org/document/8260781

2. Antonio, N., de Almeida, A., & Nunes, L. (2017). Predicting hotel booking cancellations to decrease uncertainty and increase revenue.Tourism & Management Studies, 13(2), 25–39.
https://www.researchgate.net/publication/310504011_Predicting_Hotel_Booking_Cancellation_to_Decrease_Uncertainty_and_Increase_Revenue

3. Abeyrathne, C., & Bandara, H. M. N. D. (2023). Hotel booking cancellation prediction system using machine learning. Faculty of Engineering, University of Ruhuna. https://www.researchgate.net/publication/380515766_Hotel_Booking_Cancellation_Prediction_System_using_Machine_Learning

