---
title: 'DATS6101 Project 1: Exploring Hotel Booking Cancellations'
author: "Group 6 : Jasreen Kaur Mehta, Pranav Dhawan, Tycho Gormley"
date: '`r Sys.Date()`'
output:
  html_document:
    code_folding: show
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=FALSE}
#Import required libraries
library(ezids)
library(ggplot2)
library(dplyr)
library(corrplot)

#Setup knitter options
knitr::opts_chunk$set(warning = F, message = F)
options(scientific=T, digits = 3)
```

# **Introduction**

## **About The Project**

In the hotel industry, effective management of bookings is crucial for optimizing revenue and ensuring operational efficiency. Hotels experience a variety of booking patterns, some of which include cancellations or no-shows. While some customers may cancel due to changing plans, others may not show up despite a confirmed reservation. To mitigate financial losses and maximize occupancy, it’s important for hotels to understand the underlying factors that contribute to these cancellations.\

In this project, we aim to study the factors influencing hotel booking cancellations and no-shows while answering some SMART questions. By examining customer attributes such as room preferences, lead time (the number of days between the booking date and arrival date), meal plan choices, and past booking behavior, we will identify key patterns and trends. Additionally, we will analyze other variables such as special requests, arrival month and market segments.\

## **SMART Questions**

**1.    **Do customers who make special requests cancel their bookings less frequently than those who don’t?\
**2.    **Are guests with no previous cancellations more likely to avoid canceling their current booking?\
**3.    **What are the key factors that show the strongest correlation with booking cancellations?\
**4.    **How do hotel cancellation rates change across different seasons (spring, fall, winter, summer, holidays, low season), and which factors (e.g., lead time, room type/) correlate most strongly with cancellations during each season?\
**5.    **What are the differences in cancellation rates based on meal plan type, lead time, room type, and market segment, and what are the 95% confidence intervals for these rates?\

## **About The Dataset**

For this project, we have selected a hotel booking dataset containing over 36,000 records of bookings. **[INNHotelsGroup dataset]**(https://www.kaggle.com/datasets/mariyamalshatta/inn-hotels-group) from Kaggle. This dataset offers a comprehensive overview of hotel booking patterns, making it ideal for our analysis on cancellations and no-shows.

```{r import_dataset}
hotel_data <- read.csv("../Dataset/INNHotelsGroup.csv")
```

This dataset contains `r nrow(hotel_data)` observations of `r ncol(hotel_data)` variables. Out of these observations, `r sum(is.na(hotel_data))` rows contain null values.

```{r data_structure}
str(hotel_data)
```
**Data Dictionary**

* Booking_ID: unique identifier of each booking
* no_of_adults: Number of adults
* no_of_children: Number of Children
* no_of_weekend_nights: Number of weekend nights (Saturday or Sunday) the guest stayed or booked to stay at the hotel
* no_of_week_nights: Number of week nights (Monday to Friday) the guest stayed or booked to stay at the hotel
* type_of_meal_plan: Type of meal plan booked by the customer:
    * Not Selected – No meal plan selected
    * Meal Plan 1 – Breakfast
    * Meal Plan 2 – Half board (breakfast and one other meal)
    * Meal Plan 3 – Full board (breakfast, lunch, and dinner)
* required_car_parking_space: Does the customer require a car parking space? (0 - No, 1- Yes)
* room_type_reserved: Type of room reserved by the customer. The values are ciphered (encoded) by INN Hotels.
* lead_time: Number of days between the date of booking and the arrival date
* arrival_year: Year of arrival date
* arrival_month: Month of arrival date
* arrival_date: Date of the month
* market_segment_type: Market segment designation.
* repeated_guest: Is the customer a repeated guest? (0 - No, 1- Yes)
* no_of_previous_cancellations: Number of previous bookings that were canceled by the customer prior to the current booking
* no_of_previous_bookings_not_canceled: Number of previous bookings not canceled by the customer prior to the current booking
* avg_price_per_room: Average price per day of the reservation; prices of the rooms are dynamic. (in euros)
* no_of_special_requests: Total number of special requests made by the customer (e.g. high floor, view from the room, etc)
* booking_status: Flag indicating if the booking was canceled or not.

## **Cleaning The Dataset**

For our project, we are interested in majority of the variables but there are some irrelevant columns with respect to our objective and thus we will drop them.

```{r clean_data}
hotel_data_clean <- hotel_data[, c("no_of_adults", "no_of_children", "no_of_weekend_nights", "no_of_week_nights", "type_of_meal_plan", "required_car_parking_space", "room_type_reserved", "lead_time", "arrival_year", "arrival_month",  "market_segment_type", "repeated_guest", "no_of_previous_cancellations", "no_of_special_requests", "booking_status", 
"avg_price_per_room")]

hotel_data_clean <- na.omit(hotel_data_clean)
```

After cleaning, we are left with `r nrow(hotel_data_clean)` observations of `r ncol(hotel_data_clean)` variables.

```{r save_data}
write.csv(hotel_data_clean,"../Dataset/INNHotelsGroup_min.csv", row.names = F)
```

# **Exploratory Data Analysis (EDA)**

## Summary Statistics for Numerical Columns

```{r}
num_cols <- sapply(data, is.numeric)
print(summary(data[ , num_cols]))
```

**Observations:**

The average price per room in the dataset is 103.4 euros, with a median of 99 euros, but prices can reach up to 540 euros, indicating high-priced outliers. Some entries even show an average price of zero, possibly reflecting promotional deals. Guests typically stay for two weekday nights and one weekend night, with the average number of weekday nights being 2.2 and weekend nights 0.81. Stays can extend to as many as 17 weekday nights. Most bookings involve two adults, and many guests do not bring children. Lead times vary significantly, with an average of 85 days, a median of 57, and some bookings made up to 443 days in advance, suggesting a right-skewed distribution. The data also shows sparse previous cancellations, with an average of just 0.02, and a maximum of 58. Bookings are spread over 2017 and 2018, peaking in August of 2018. Additionally, most guests do not make special requests, as the median is zero, although some make up to five requests per booking.

## **1. Distribution of Booking Status**
```{r plot1}
ggplot(hotel_data_clean, aes(x = booking_status)) +
  geom_bar(fill = "lightblue") +
  labs(title = "Booking Status Distribution", x = "Booking Status", y = "Count")
```

**Summary**\
The dataset contains 36,275 bookings, with 24,390 classified as “Not Canceled” and 11,885 as “Canceled”. Approximately two-thirds of the bookings were completed, while the remaining one-third were canceled.\

## **2. Analysis of Meal Plan Type**\
```{r plot2}
ggplot(hotel_data_clean, aes(x = type_of_meal_plan, fill = booking_status)) +
  geom_bar(position = "fill") +
  labs(title = "Cancellation Rate by Meal Plan", x = "Meal Plan", y = "Proportion", fill = "Booking Status")
```

**Summary** \ 
Meal Plan 1 has the highest cancellation rate, where more than half of the bookings are canceled.
Meal Plan 2 has a lower cancellation rate, with cancellations and non-cancellations being nearly equal.
Meal Plan 3 shows the highest proportion of non-cancelled bookings compared to canceled ones, suggesting customers choosing this meal plan tend to cancel less frequently.
For the "Not Selected" category, there is a relatively high cancellation rate, similar to Meal Plan 1.

## **3. Distribution of Room Types**\
```{r plot3}
ggplot(hotel_data_clean, aes(x = room_type_reserved, fill = booking_status)) +
  geom_bar(position = "fill") +
  labs(title = "Cancellation Rate by Room Type", x = "Room Type", y = "Proportion", fill = "Booking Status")
```

**Summary** \
Room Type 1 and Room Type 6 have the highest cancellation rates, with a large proportion of canceled bookings.
Room Type 7 stands out as having the highest proportion of non-cancelled bookings, suggesting it may be a preferred or better-secured type of room.
For other room types, the rates are fairly similar, with around 60-70% of bookings not canceled, except for Room Type 1 which has more cancellations.

## **4. Barplot: Number of Special Requests** \
```{r plot4}
ggplot(hotel_data_clean, aes(x = factor(no_of_special_requests))) +
  geom_bar(fill = "orange") +
  labs(title = "Number of Special Requests", x = "Number of Special Requests", y = "Count") +
  theme_minimal()
```

**Summary** \ 
Most guests make no special requests, with a sharp decline as the number increases. A significant portion makes one request, while two or more requests are increasingly rare.

## **5. Plot: Market Segment vs Booking Status** \
```{r plot5}
contingency_table <- table(hotel_data_clean$market_segment_type, hotel_data_clean$booking_status)

plot_data <- as.data.frame(contingency_table)
colnames(plot_data) <- c("Market_Segment", "Booking_Status", "Count")

ggplot(plot_data, aes(x = Market_Segment, y = Count, fill = Booking_Status)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Booking Status by Market Segment",
       x = "Market Segment",
       y = "Count",
       fill = "Booking Status") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

# **Statistical Analysis** 

## **1. Do customers who make special requests cancel their bookings less frequently than those who don’t? : Chi-Square Test**
**Null Hypothesis (H₀)**: There is no significant association between special requests and booking status.\
**Alternative Hypothesis (H₁:)**There is significant association between special request and booking status.\

```{r chi_sqaure_test1}
hotel_data_clean <- hotel_data_clean %>%
  mutate(has_special_requests = ifelse(no_of_special_requests > 0, "Yes", "No"),
         is_cancelled = ifelse(booking_status == "Canceled", "Canceled", "Not_Canceled"))

print(table(hotel_data_clean$has_special_requests))
print(table(hotel_data_clean$is_cancelled))

special_requests_table <- table(hotel_data_clean$has_special_requests, hotel_data_clean$is_cancelled)

sum(special_requests_table) > 0
  special_requests_test <- chisq.test(special_requests_table)

  special_requests_props <- prop.table(special_requests_table, margin = 1)

  print("Contingency Table:")
print(special_requests_table)

print("Chi-Square Test Results:")
print(special_requests_test)

  ggplot(hotel_data_clean, aes(x = has_special_requests, fill = is_cancelled)) +
    geom_bar(position = "fill") +
    labs(title = "Cancellation Rates by Special Requests",
         x = "Has Special Requests", y = "Proportion") +
    theme_minimal()
```

The chi-square test's extremely low p-value (< 0.05) indicates strong evidence against the null hypothesis. We can reject the null hypothesis and conclude that there is a significant association between special requests and cancellation rates.

Bookings with special requests have a much lower cancellation rate (20.2%) compared to those without (43.2%). The data strongly suggests that customers who make special requests are more likely to follow through with their bookings and significantly less likely to cancel their bookings.

## **2. Are guests with no previous cancellations more likely to avoid canceling their current booking? : Chi-Square Test**
**Null Hypothesis (H₀):** There is no association between having previous cancellations and the likelihood of canceling the current booking.\
**Alternative Hypothesis (H₁):** Guests with no previous cancellations are less likely to cancel their current booking.\

```{r chi_sqaure_test2}
hotel_data_clean <- hotel_data_clean %>%
  mutate(has_previous_cancellations = ifelse(no_of_previous_cancellations > 0, "Yes", "No"))

previous_cancellations_table <- table(hotel_data_clean$has_previous_cancellations, hotel_data_clean$is_cancelled)
previous_cancellations_test <- chisq.test(previous_cancellations_table)

previous_cancellations_props <- prop.table(previous_cancellations_table, margin = 1)

  print("Contingency Table:")
print(previous_cancellations_table)

print("Chi-Square Test Results:")
print(previous_cancellations_test)

ggplot(hotel_data_clean, aes(x = has_previous_cancellations, fill = is_cancelled)) +
  geom_bar(position = "fill") +
  labs(title = "Cancellation Rates by Previous Cancellations",
       x = "Has Previous Cancellations", y = "Proportion") +
  theme_minimal()
```

The chi-square test's extremely low p-value (< 0.05) indicates strong evidence against the null hypothesis. We can reject the null hypothesis and conclude that there is a significant association between having previous cancellations and the likelihood of canceling the current booking.

Surprisingly, bookings from guests with previous cancellations have a much lower cancellation rate (4.73%) compared to those without previous cancellations (33.03%). This represents a substantial difference of about 28.3 percentage points.

## **Correlation Matrix: Key Factors Influencing Cancellations**
**Null Hypothesis (H₀):** There is no correlation between the selected factors (lead time, price, special requests, etc.) and booking cancellations.\
**Alternative Hypothesis (H₁):** There is a significant correlation between one or more factors and booking cancellations.\

```{r test3}

```

## **4th SMART Question**
**Null Hypothesis (H₀):**\
**Alternative Hypothesis (H₁):**\

```{r test4}

```

## **5th SMART Question**
**Null Hypothesis (H₀):**\
**Alternative Hypothesis (H₁):**\

```{r test5}

```

# **Conclusion**

1. This analysis suggests that a guest's previous cancellation history could be a reliable predictor of their future booking behavior. Hotels could use this information to refine their overbooking strategies, potentially allocating more flexible cancellation policies to first-time guests or those without a history of cancellations. Conversely, they might implement stricter policies or require deposits from guests with a history of cancellations to mitigate potential losses.

2.Cancellation rate for bookings without special requests: 8545 / (8545 + 11232) ≈ 43.2%. Cancellation rate for bookings with special requests: 3340 / (3340 + 13158) ≈ 20.2%. There's a clear difference in cancellation rates, with bookings having special requests showing a significantly lower cancellation rate.


