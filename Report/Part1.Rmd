---
title: 'DATS6101 Project 1: Exploring Hotel Booking Cancellations'
author: 'Group 6'
date: '`r Sys.Date()`'
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r init, include=FALSE}
#Import required libraries
library(ezids)
library(ggplot2)
library(dplyr)

#Setup knitter options
knitr::opts_chunk$set(warning = F, message = F)
options(scientific=T, digits = 3)
```

# **Introduction**

## **About The Project**

In the hotel industry, effective management of bookings is crucial for optimizing revenue and ensuring operational efficiency. Hotels experience a variety of booking patterns, some of which include cancellations or no-shows. While some customers may cancel due to changing plans, others may not show up despite a confirmed reservation. To mitigate financial losses and maximize occupancy, it’s important for hotels to understand the underlying factors that contribute to these cancellations.\

In this project, we aim to study the factors influencing hotel booking cancellations and no-shows while answering some SMART questions. By examining customer attributes such as room preferences, lead time (the number of days between the booking date and arrival date), meal plan choices, and past booking behavior, we will identify key patterns and trends. Additionally, we will analyze other variables such as special requests, arrival month and market segments.\

## **SMART Questions**

**1.    **How much less frequently do customers who make special requests cancel from 2017 to 2018 than those who don't?\ 
**2.    **Are guests with no previous cancellations more likely to avoid canceling their current booking?\
**3.    **What are the key factors that show the strongest correlation with booking cancellations?\
**4.    **How do hotel cancellation rates change across different seasons (spring, fall, winter, summer, holidays, low season), and which factors (e.g., lead time, room type/) correlate most strongly with cancellations during each season?\
**5.    **What are the differences in cancellation rates based on meal plan type, lead time, room type, and market segment, and what are the 95% confidence intervals for these rates?\

## **About The Dataset**

For this project, we have selected a hotel booking dataset containing over 36,000 records of bookings. [INNHotelsGroup dataset](https://www.kaggle.com/datasets/mariyamalshatta/inn-hotels-group) from Kaggle. This dataset offers a comprehensive overview of hotel booking patterns, making it ideal for our analysis on cancellations and no-shows.

```{r import_dataset}
hotel_data <- read.csv("../Dataset/INNHotelsGroup.csv")
```

This dataset contains `r nrow(hotel_data)` observations of `r ncol(hotel_data)` variables. Out of these observations, `r sum(is.na(hotel_data))` rows contain null values.

```{r data_structure}
str(hotel_data)
```

```{r data_unique_values}
print(unique(hotel_data$no_of_special_requests))
print(unique(hotel_data$booking_status))
```

## **Cleaning The Dataset**

For our project, we are interested in majority of the variables but there are some irrelevant columns with respect to our objective and thus we will drop them.

```{r clean_data}
hotel_data_clean <- hotel_data[, c("no_of_adults", "no_of_children", "no_of_weekend_nights", "no_of_week_nights", "type_of_meal_plan", "required_car_parking_space", "room_type_reserved", "lead_time", "arrival_year", "arrival_month",  "market_segment_type", "repeated_guest", "no_of_previous_cancellations", "no_of_special_requests", "booking_status", 
"avg_price_per_room")]

hotel_data_clean <- na.omit(hotel_data_clean)
```

After cleaning, we are left with `r nrow(hotel_data_clean)` observations of `r ncol(hotel_data_clean)` variables.

```{r save_data}
write.csv(hotel_data_clean,"../Dataset/INNHotelsGroup_min.csv", row.names = F)
```

# **Exploratory Data Analysis (EDA)**

## **1. Distribution of Booking Status**
```{r plot1}
ggplot(hotel_data_clean, aes(x = booking_status)) +
  geom_bar(fill = "lightblue") +
  labs(title = "Booking Status Distribution", x = "Booking Status", y = "Count")
```

**Summary**
The number of non-canceled bookings is significantly higher than the number of canceled bookings. This indicates that most bookings in the dataset were not canceled.

## **2. Analysis of Meal Plan Type**
```{r plot2}
ggplot(hotel_data_clean, aes(x = type_of_meal_plan, fill = booking_status)) +
  geom_bar(position = "fill") +
  labs(title = "Cancellation Rate by Meal Plan", x = "Meal Plan", y = "Proportion", fill = "Booking Status")
```

**Summary**
Meal Plan 1 has the highest cancellation rate, where more than half of the bookings are canceled.
Meal Plan 2 has a lower cancellation rate, with cancellations and non-cancellations being nearly equal.
Meal Plan 3 shows the highest proportion of non-cancelled bookings compared to canceled ones, suggesting customers choosing this meal plan tend to cancel less frequently.
For the "Not Selected" category, there is a relatively high cancellation rate, similar to Meal Plan 1.

## **3. Distribution of Room Types**
```{r plot3}
ggplot(hotel_data_clean, aes(x = room_type_reserved, fill = booking_status)) +
  geom_bar(position = "fill") +
  labs(title = "Cancellation Rate by Room Type", x = "Room Type", y = "Proportion", fill = "Booking Status")
```

**Summary**
Room Type 1 and Room Type 6 have the highest cancellation rates, with a large proportion of canceled bookings.
Room Type 7 stands out as having the highest proportion of non-cancelled bookings, suggesting it may be a preferred or better-secured type of room.
For other room types, the rates are fairly similar, with around 60-70% of bookings not canceled, except for Room Type 1 which has more cancellations.

## **4. Barplot: Number of Special Requests**
```{r plot4}
ggplot(hotel_data_clean, aes(x = factor(no_of_special_requests))) +
  geom_bar(fill = "orange") +
  labs(title = "Number of Special Requests", x = "Number of Special Requests", y = "Count") +
  theme_minimal()
```

**Summary**
The bar chart shows that most hotel bookings have zero or one special request, with about 20,000 and 13,000 bookings, respectively. The number of bookings decreases sharply as the number of requests increases. Very few customers make more than two requests, indicating minimal specific demands from the majority.

# **Statistical Analysis** 

## **1. Chi-Square Test: Special Requests vs. No Special Requests**
**Null Hypothesis (H₀)**: There is no significant difference in the cancellation rates between customers who make special requests and those who do not.\
**Alternative Hypothesis (H₁:)** Customers with special requests cancel less frequently than those without.\

```{r chi_sqaure_test1}
hotel_data_clean <- hotel_data_clean %>%
  mutate(has_special_requests = ifelse(no_of_special_requests > 0, "Yes", "No"),
         is_cancelled = ifelse(booking_status == "Canceled", "Canceled", "Not_Canceled"))

print(table(hotel_data_clean$has_special_requests))
print(table(hotel_data_clean$is_cancelled))

special_requests_table <- table(hotel_data_clean$has_special_requests, hotel_data_clean$is_cancelled)

sum(special_requests_table) > 0
  special_requests_test <- chisq.test(special_requests_table)

  special_requests_props <- prop.table(special_requests_table, margin = 1)

  ggplot(hotel_data_clean, aes(x = has_special_requests, fill = is_cancelled)) +
    geom_bar(position = "fill") +
    labs(title = "Cancellation Rates by Special Requests",
         x = "Has Special Requests", y = "Proportion") +
    theme_minimal()
```

The chi-square test's extremely low p-value (< 0.05) indicates strong evidence against the null hypothesis. We can reject the null hypothesis and conclude that there is a significant association between special requests and cancellation rates.

Bookings with special requests have a much lower cancellation rate (20.2%) compared to those without (43.2%). The data strongly suggests that customers who make special requests are more likely to follow through with their bookings and significantly less likely to cancel their bookings.

## **2. Chi-Square Test: Previous Cancellations vs. Current Cancellation**
**Null Hypothesis (H₀):** There is no association between having previous cancellations and the likelihood of canceling the current booking.\
**Alternative Hypothesis (H₁):** Guests with no previous cancellations are less likely to cancel their current booking.\

```{r chi_sqaure_test2}
hotel_data_clean <- hotel_data_clean %>%
  mutate(has_previous_cancellations = ifelse(no_of_previous_cancellations > 0, "Yes", "No"))

previous_cancellations_table <- table(hotel_data_clean$has_previous_cancellations, hotel_data_clean$is_cancelled)
previous_cancellations_test <- chisq.test(previous_cancellations_table)

previous_cancellations_props <- prop.table(previous_cancellations_table, margin = 1)

ggplot(hotel_data_clean, aes(x = has_previous_cancellations, fill = is_cancelled)) +
  geom_bar(position = "fill") +
  labs(title = "Cancellation Rates by Previous Cancellations",
       x = "Has Previous Cancellations", y = "Proportion") +
  theme_minimal()
```

The chi-square test's extremely low p-value (< 0.05) indicates strong evidence against the null hypothesis. We can reject the null hypothesis and conclude that there is a significant association between having previous cancellations and the likelihood of canceling the current booking.

Surprisingly, bookings from guests with previous cancellations have a much lower cancellation rate (4.73%) compared to those without previous cancellations (33.03%). This represents a substantial difference of about 28.3 percentage points.

## **Correlation Matrix: Key Factors Influencing Cancellations**
**Null Hypothesis (H₀):** There is no correlation between the selected factors (lead time, price, special requests, etc.) and booking cancellations.\
**Alternative Hypothesis (H₁):** There is a significant correlation between one or more factors and booking cancellations.\

```{r test3}

```

## **4th SMART Question**
**Null Hypothesis (H₀):**\
**Alternative Hypothesis (H₁):**\

```{r test4}

```

## **5th SMART Question**
**Null Hypothesis (H₀):**\
**Alternative Hypothesis (H₁):**\

```{r test5}

```

# **Conclusion**

